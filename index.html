<!DOCTYPE html>

<html>
	<head>
		<title>Voorbeeld PWA webpagina</title>
		
		<!-- Zorgen voor weergeven juiste zoom-level v/d webpagina -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<!-- Inladen van het manifest bestand -->
		<link rel="manifest" href="manifest.json" />
		
		<!-- Service Worker registreren -->
		<script>
			window.onload = function(){
				if ('serviceWorker' in navigator) {
					navigator.serviceWorker.register('scripts/sw.js').then(
						registratie=> {
							console.log(`Registratie gelukt: ${registratie.scope}`);
							
							if ('PushManager' in window){
								console.log("Push berichten worden ondersteund!");
								
								/* Maken checkBox voor uberhaupt wel of geen melding
								   willen krijgen Ã³f ze berichten willen ontvangen
								   
								let jaNeePush = document.createElement("input");
								jaNeePush.setAttribute("type","checkbox");
								jaNeePush.setAttribute("id","jaNeePush");
								
								let jaNeeDiv = document.createElement("div");
								let jaNeeVraag = document.createTextNode("Push notificaties?");
								jaNeeDiv.appendChild(jaNeeVraag);
								jaNeeDiv.appendChild(jaNeePush);
								document.body.appendChild(jaNeeDiv);
								
								*/
								
								
								/* Push subscriptie checken */
								registratie.pushManager.getSubscription().then(
									sub =>{
										if (sub === null) {
											maakPushUser(registratie);
										}
									}
								)
								
							}
						}
					).catch(
						fout=> {
							console.log(`Er is iets foutgegaan: ${fout}`);
						}
					);
					
					function maakPushUser(registratie){
						const applicationServerKey = "bla";
						
						registratie.pushManager.subscribe(
							{
								userVisibleOnly: true,
								applicationServerKey: applicationServerKey
							}
						).then(
							sub => {
								updateSubscriptionAtServer(sub);
								console.log("User geabonneerd op meldingen");
							}
						).catch(
							fout => {
								console.log(`Abonneren op notificaties niet gelukt: ${fout}`);
							}
						);
					}
					
					function updateSubscriptionAtServer(subscriptie){
						/* Hier schrijven we normaal info naar de server */
						console.dir(subscriptie);
					}
				}
			}
		</script>
	</head>
	<body>
			<header>
				<h1>Voorbeeld PWA webpagina</h1>
				<nav></nav>
			</header>
			<main>
				<article>
					<section></section>
					<section></section>
				</article>
			</main>
			<footer>
				<section></section>
			</footer>
	</body>
</html>